## 前言
* 数据展现要获得成功，就必须建立在 __简单性__ 的基础之上
* __维度建模__ 是 DW/BI 项目成功的关键
* __一致性维度__、缓慢变化维度、异构产品、无事实的事实表、[企业数据仓库总线矩阵](https://help.aliyun.com/document_detail/118629.html)

## 第一章
* 紧紧抓住 __业务需求__ 这一要点
* 数据作用: 1. 操作型记录永久保存 2. 分析型决策制定
* 业务话题:
    1. 业务人员需要 __方便__ 的获取数据
    2. 将最重要的数据展示给我
    3. 会议讨论数字谁对谁错，而不是制定决策
    4. 基于事实的决策制定
* DW 系统必须一致的展现信息——同名同义性
* __至关重要! DW 系统最重要的输出是基于分析证据所产生的决策__
* __至关重要! DW 系统成功的标志是业务群体接受此系统__
* 物理世界的每一个度量事件与对应的事实表行具有一对一的关系，这一思想是维度建模的基本原则
    * 最实用的事实是数值类型和可加类型
    * 自由文本数据(外卖备注)几乎没有对其进行分析的可能性
    * 事实表粒度: 事务、周期性快照、累积快照
    * 通常几个维度 key 一起标志性每个事实表行
* 用于描述上下文的维度表(谁、什么、哪里、何时、如何、为什么)
    * 维表中属性应该尽量使用解码值
    * 为维度属性提供详细的业务术语，DW/BI 系统的分析能力就越好
    * 维度表被称为数据仓库的"灵魂"
* 极力反对独立数据集市，应当根据 __业务过程__ 而不是部门构建系统，实现一致性和集成
* 汇总数据只是在针对查询时能够比细节数据提供更好的性能，但它 __不能取代细节数据__
* 表中的字段，有且只有4种功能: 分组(group by)、过滤(where)、汇总(count, distinct, sum)、连接(join)

## 第二章
* 与业务代表交流理解、发现需求(关键指标、竞争性商业问题、决策制定过程)
* 与源系统专家交流了解数据的实际情况 1.判断分析可行性 2.确保涵盖正确的业务
* 维度设计过程
    1. 选择业务过程
    2. 声明粒度
    3. 确认维度
    4. 确认事实
* 业务过程定义了粒度、维度、事实; 每个业务过程对应企业数据仓库总线矩阵的一行
* __声明粒度__
    * 事实表能表达数据的详细程度就确定了
    * 同一事实表中不要混用多种粒度
    * 事实表的粒度越细，能记载的信息就会越多
    * 原子粒度是最低级别的粒度
    * 医生开具的票据内容采用一行表示
    * 机场登机口处理的每张登机牌
    * 每个银行账户每一笔交易
* 将这个粒度的上下文信息都添加为维度
* 将这个粒度的度量信息都添加为事实(零售事务中，销售产品的数量和总额总是良好的事实)
* 维度模型的扩展性
    1. 当事实与存在事实 __粒度一致__ 时，可以创建新列
    2. 当事实与存在事实 __粒度一致__ 时，可以新建维度列
    3. 可以在维表添加新的属性
    4. 可以使事实表粒度更原子化，方法是在维表上增加属性，然后以更细的粒度重置事实表
* 事实表的设计完全依赖于物理活动，不受可能产生的最终报表的影响
* 最有用的事实是完全可加(已支付订单)
* 半可加事实(银行卡余额)
* 对于不可加事实(比率)尽量存储可加的分量
* 事务事实表 dwd
* 周期快照事实表 periodic
* 累积快照事实表 accumulating 每行代表一个业务周期、新增和更新
* 无度量的事实表，多维实体
* 合并事实表，相同粒度的多个业务过程合并为同一张事实表，使 BI 分析变得简单便捷
* 维度表技术
    1. 单一的主键列
    2. 维度表通常比较宽，呈扁平状
    3. 维度表通常负责 过滤、分组 的目标
    4. 退化维度 a. 没有对应的维表 b.存储在事实表中
    5. 使用 'Unknown' 代替 NULL
    6. 不要指望 SQL 计算复活节，但可以在日历维度上寻找复活节
    7. 扁平化的、非规范的维度表易于理解，避免使用雪花模式
    8. 多数情况下，维度之间的关联应该由事实表来实现
* 一致性维度: 建立具有统一解释的标准化的维度
* 企业数据仓库总线矩阵每一行表示一种业务过程，列表示维度
* Slowly Changing Dimension
    1. 重写
    2. 增加新行 有效开始日期-有效结束日期，当前行唯一标识(事实表中存此标识)
    3. 对于变化不大的维度表，可以使用拉链的方式节省存储(如果数据量本身不大，每天一份快照也是可选的)
    4. 对于变化较大的维度表，不如直接每天一份快照
* 桥接表处理参差不齐的层次问题 merge_city_bridge

## 第三章 零售业务

* 理解维度建模的最佳途径是研究一系列真实存在的案例
* 管理层希望获得客户购买情况，因此将要建模的业务过程是 POS 零售交易
* 零售中最细粒度的数据是 POS 交易单个产品，提供细粒度数据是因为查询需要以非常精确的方式对细节切分
* 事实表粒度选择完毕后，维度选择就比较直接了，日期、产品、门店、促销、收银员、支付方式
* 确认哪些度量放入事实表中，度量必须与粒度吻合，销售数量、销售额、成本额
* 估计事实表中的行数是非常有必要的，作为一个设计者，应该始终通过多角度测量确定计算是否合理
* 日期维度、产品维度、商店维度、促销维度(促销有很多分析点)、


## 大数据分析

* 多数大数据都不能用类似 SQL 的方法来分析，大数据是一种模式的转变
* 应用: 搜索排序、因果关系发现、广告跟踪、基因分析、群组发现、金融账户欺诈检测、客户流失分析、贷款风险分析
* 大数据综合处理: 支持 SQL、吞吐量大、支持 UDF、实时性、不必预聚合、容错稳定、十分钟级别返回结果
* 多数业务过程都可以用不超过 20 个维度的事实表表示